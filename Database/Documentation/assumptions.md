# Assumptions – Profit Margin Monitoring System

This document lists the key business, data, and technical assumptions used when designing
the logical data model (ERD + data dictionary) for the Profit Margin Monitoring System.

---

## 1. Business Assumptions

1. The business operates in a **single currency**.  
   - All monetary columns (`cost_price`, `list_price`, `line_total`, `total_amount`, etc.)
     are stored in that currency.
2. Each **sale** must belong to exactly one **branch** and one **order**.  
   - A branch can have many sales orders; an order can have many sales lines.
3. A **product** is sold under one SKU at a time.  
   - If a major change happens (e.g., new SKU), it is treated as a new product.
4. Margin alerts are **informational** and do not block the transaction.  
   - Sales can still be completed even if an alert is generated.
5. Only **authorized users** (e.g., managers, pricing analysts) will review and close alerts.

---

## 2. Data Assumptions

1. `PRODUCT.cost_price` stores the **latest cost snapshot** for fast access.  
   - Historical cost changes are stored in `COST_HISTORY`.
2. `COST_HISTORY` rows are **immutable**.  
   - When cost changes, a new row is inserted with a new `effective_date`.
3. `SALES_ORDER.total_amount` is **redundant but intentional**.  
   - It can be derived from `SALES_LINE`, but is stored to speed up reporting.
4. `SALES_LINE.line_total` is always consistent with  
   `qty * unit_price * (1 - discount_pct/100)`.  
   - This is enforced by application logic or triggers.
5. `MARGIN_ALERT`:
   - May reference an `order_id`, a `line_id`, or both.  
   - Always references at least one `product_id`.  
   - `branch_id` is the branch where the sale happened.
6. `MARGIN_BASELINE` rows represent **pre-calculated summaries** (e.g., monthly averages).  
   - There is at most one baseline per `(product_id, branch_id, period_start)`.

---

## 3. Technical / Modeling Assumptions

1. The model is normalized to at least **3NF**:
   - Master data separated (BRANCH, PRODUCT).
   - Transaction data separated (SALES_ORDER, SALES_LINE).
   - Historical and analytical data separated (COST_HISTORY, MARGIN_BASELINE, MARGIN_ALERT).
2. All primary keys are **surrogate numeric keys** (`NUMBER`) generated by sequences.
3. Foreign keys use **ON DELETE RESTRICT** by default to avoid accidental cascading deletes.  
   - Alerts may survive even if related facts are archived.
4. Status and flag columns (`active`, `status`) use **simple fixed code sets**:
   - `PRODUCT.active` ∈ { 'Y', 'N' }  
   - `MARGIN_ALERT.status` ∈ { 'OPEN', 'REVIEWED', 'CLOSED' }
5. `AUDIT_LOG` stores **old and new values** as text (e.g., JSON-like or delimited).
   - The exact format is defined at implementation time but is not enforced by the model.

---

## 4. BI / Reporting Assumptions

1. `SALES_LINE` is the **grain** for the main fact table in BI (one row per sales line).
2. Time-based reporting will use either:
   - `order_date` from `SALES_ORDER`, or  
   - a separate `TIME_DIM` table in the BI layer.
3. Margin calculations in reports are **reproducible** using:
   - `SALES_LINE` values, and  
   - historical cost from `COST_HISTORY` based on `effective_date`.
4. Performance-critical reports may rely on **pre-aggregated tables** (not shown in the ERD)
   built from this normalized model.



